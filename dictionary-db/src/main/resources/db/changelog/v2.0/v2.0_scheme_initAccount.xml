<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">
    <changeSet id="add_accounts" author="Gordeeva_Mary">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="accounts"/>
            </not>
        </preConditions>

        <createTable tableName="accounts">
            <column name="id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="bank_id" type="BIGINT"/>
            <column name="account_status" type="VARCHAR(20)"/>
            <column name="account_number" type="BIGINT"/>
            <column name="client_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="add_pkey_accounts" author="Gordeeva_Mary">
        <preConditions onFail="MARK_RAN">
            <not>
                <primaryKeyExists primaryKeyName="accounts_pkey"/>
            </not>
        </preConditions>
        <addPrimaryKey columnNames="id" constraintName="accounts_pkey"
                       tableName="accounts"/>
    </changeSet>

    <changeSet id="add_fk_for_bankId_accounts" author="Gordeeva_Mary">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="bank_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseTableName="accounts" baseColumnNames="bank_id" constraintName="bank_id" referencedTableName="banks"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="add_accounts_seq" author="Gordeeva_Mary">
        <preConditions onFail="MARK_RAN">
            <not>
                <sequenceExists sequenceName="accounts_sequence"/>
            </not>
        </preConditions>
        <createSequence sequenceName="accounts_sequence" startValue="5" incrementBy="1"/>
    </changeSet>

    <changeSet id="add_data_accounts" author="Gordeeva_Mary" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="accounts"/>
        </preConditions>
        <loadUpdateData
                tableName="accounts"
                primaryKey="id"
                file="db/data/accounts.csv"/>
    </changeSet>
</databaseChangeLog>